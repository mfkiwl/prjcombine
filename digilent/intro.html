<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction, general protocol &mdash; Project Combine  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DMGT: Management subsystem" href="dmgt.html" />
    <link rel="prev" title="Digilent Adept Programmers" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Project Combine
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../xilinx/index.html">Xilinx FPGAs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../siliconblue/index.html">SiliconBlue FPGAs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xc9500/index.html">Xilinx XC9500, XC9500XL, XC9500XV CPLDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xpla3/index.html">Xilinx XPLA3 CPLDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coolrunner2/index.html">Xilinx Coolrunner II CPLDs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Digilent Adept Programmers</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction, general protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#control-requests">Control requests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#get-product-name"><code class="docutils literal notranslate"><span class="pre">GET_PRODUCT_NAME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-user-name"><code class="docutils literal notranslate"><span class="pre">GET_USER_NAME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-user-name"><code class="docutils literal notranslate"><span class="pre">SET_USER_NAME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-serial-number"><code class="docutils literal notranslate"><span class="pre">GET_SERIAL_NUMBER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-serial-number"><code class="docutils literal notranslate"><span class="pre">SET_SERIAL_NUMBER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-firmware-version"><code class="docutils literal notranslate"><span class="pre">GET_FIRMWARE_VERSION</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-caps"><code class="docutils literal notranslate"><span class="pre">GET_CAPS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-secret-handshake"><code class="docutils literal notranslate"><span class="pre">SET_SECRET_HANDSHAKE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-product-id"><code class="docutils literal notranslate"><span class="pre">GET_PRODUCT_ID</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-secret-handshake"><code class="docutils literal notranslate"><span class="pre">GET_SECRET_HANDSHAKE</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#subsystem-commands">Subsystem commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-management-commands">System management commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sys-abort-command"><code class="docutils literal notranslate"><span class="pre">SYS_ABORT</span></code> command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sys-reset-command"><code class="docutils literal notranslate"><span class="pre">SYS_RESET</span></code> command</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#general-subsystem-commands">General subsystem commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enable-command"><code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#disable-command"><code class="docutils literal notranslate"><span class="pre">DISABLE</span></code> command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-port-properties-command"><code class="docutils literal notranslate"><span class="pre">GET_PORT_PROPERTIES</span></code> command</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dmgt.html">DMGT: Management subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="djtg.html">DJTG: JTAG controller subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="dpio.html">DPIO: simple GPIO subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="depp.html">DEPP: parallel port subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="dspi.html">DSPI: SPI controller subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="devices.html">Devices</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Project Combine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Digilent Adept Programmers</a></li>
      <li class="breadcrumb-item active">Introduction, general protocol</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/digilent/intro.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction-general-protocol">
<h1>Introduction, general protocol<a class="headerlink" href="#introduction-general-protocol" title="Link to this heading"></a></h1>
<p>Digilent made a family of devboards using a common custom USB protocol.
For lack of a better name, we call it the Digilent Adept protocol.</p>
<p>The protocol is designed to be extensible: there is a set of control requests
that can be used to query information about the board and the capabilities,
and then there is a common multiplexing and framing protocol used to
communicate with one of the device’s “subsystems”, such as JTAG, SPI, GPIO,
or board management.</p>
<p>The protocol is implemented by a variety of devices on the board side — some
of them are ATmega based, and come up directly implementing the protocol,
with upgradeability provided only by programming pins on the board.
Others are FX2 based, requiring firmware upload from the host before they
start speaking the protocol.</p>
<p>Note that Digilent has phased out this protocol — newer boards are FTDI
based instead.</p>
<p>The protocol is implemented on devices with USB ID of <code class="docutils literal notranslate"><span class="pre">0x1443:0x0007</span></code>.</p>
<p>The device exposes a single configuration and single interface.  The class,
subclass, and protocol are all-0, as would be expected.  The device has
the following endpoints:</p>
<ul class="simple">
<li><p>control endpoint 0: in addition to the usual core USB stuff, used to send
various custom control requests</p></li>
<li><p>endpoint 1 OUT (bulk, 16 bytes max packet size): used to send subsystem commands</p></li>
<li><p>endpoint 2 IN (bulk, 16 bytes max packet size): used to receive subsystem command responses</p></li>
<li><p>endpoint 3 OUT (bulk, 64 bytes max packet size): used to send large data payloads for subsystem commands</p></li>
<li><p>endpoint 4 IN (bulk, 64 bytes max packet size): used to receive large data payloads for subsystem commands</p></li>
</ul>
<p>All numbers in the protocol are encoded as little-endian unless stated otherwise.</p>
<section id="control-requests">
<h2>Control requests<a class="headerlink" href="#control-requests" title="Link to this heading"></a></h2>
<p>These control requests can be sent at any time, without any particular
preparation.</p>
<p>A few of the requests here deal with strings.  The strings are stored
on the board in fixed-length storage (different for every string),
and are NUL-terminated, except for the (legal) case of a string that takes
up the entire length of the storage.  The requests will return the entire
contents of the string storage, possibly including garbage beyond the NUL
terminator (which is usually either all-NUL or all-<code class="docutils literal notranslate"><span class="pre">0xff</span></code>).  This garbage
should be trimmed off.</p>
<section id="get-product-name">
<h3><code class="docutils literal notranslate"><span class="pre">GET_PRODUCT_NAME</span></code><a class="headerlink" href="#get-product-name" title="Link to this heading"></a></h3>
<p>Returns a product name describing the board.  The storage for that string
is 28 bytes long.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0xc0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 28</p></li>
</ul>
</section>
<section id="get-user-name">
<h3><code class="docutils literal notranslate"><span class="pre">GET_USER_NAME</span></code><a class="headerlink" href="#get-user-name" title="Link to this heading"></a></h3>
<p>Returns a “user name” describing the board.  It is a 16-byte string field.
Allegedly it can be set by the user.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0xc0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 16</p></li>
</ul>
</section>
<section id="set-user-name">
<h3><code class="docutils literal notranslate"><span class="pre">SET_USER_NAME</span></code><a class="headerlink" href="#set-user-name" title="Link to this heading"></a></h3>
<p>Sets the user name of this board.  It can be up to 16 bytes long.
Doesn’t seem to be actually supported on all boards?</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0x40</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 16</p></li>
</ul>
</section>
<section id="get-serial-number">
<h3><code class="docutils literal notranslate"><span class="pre">GET_SERIAL_NUMBER</span></code><a class="headerlink" href="#get-serial-number" title="Link to this heading"></a></h3>
<p>Returns the serial number of this board.  It is 12 bytes long.  It can be
reprogrammed by the user.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0xc0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 12</p></li>
</ul>
</section>
<section id="set-serial-number">
<h3><code class="docutils literal notranslate"><span class="pre">SET_SERIAL_NUMBER</span></code><a class="headerlink" href="#set-serial-number" title="Link to this heading"></a></h3>
<p>Sets the serial number of this board.  It can be up to 12 bytes long.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0x40</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe5</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 12</p></li>
</ul>
</section>
<section id="get-firmware-version">
<h3><code class="docutils literal notranslate"><span class="pre">GET_FIRMWARE_VERSION</span></code><a class="headerlink" href="#get-firmware-version" title="Link to this heading"></a></h3>
<p>Returns the firmware version of this board.  It is a 16-bit word.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0xc0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe6</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 2</p></li>
</ul>
</section>
<section id="get-caps">
<h3><code class="docutils literal notranslate"><span class="pre">GET_CAPS</span></code><a class="headerlink" href="#get-caps" title="Link to this heading"></a></h3>
<p>Returns the capabilities of this board.  It is a 32-bit word.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0xc0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe7</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 4</p></li>
</ul>
<p>The capabilities are a bitfield describing the available subsystems:</p>
<ul class="simple">
<li><p>bit 0: DJTG</p></li>
<li><p>bit 1: DPIO</p></li>
<li><p>bit 2: DEPP</p></li>
<li><p>bit 3: DSTM</p></li>
<li><p>bit 4: DSPI</p></li>
<li><p>bit 5: DTWI</p></li>
<li><p>bit 6: DACI</p></li>
<li><p>bit 7: DAIO</p></li>
<li><p>bit 8: DEMC</p></li>
<li><p>bit 9: DDCI</p></li>
<li><p>bit 10: DGIO</p></li>
</ul>
</section>
<section id="set-secret-handshake">
<h3><code class="docutils literal notranslate"><span class="pre">SET_SECRET_HANDSHAKE</span></code><a class="headerlink" href="#set-secret-handshake" title="Link to this heading"></a></h3>
<p>Sets a 16-bit number used in the secret handshake.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0x40</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 2</p></li>
</ul>
</section>
<section id="get-product-id">
<h3><code class="docutils literal notranslate"><span class="pre">GET_PRODUCT_ID</span></code><a class="headerlink" href="#get-product-id" title="Link to this heading"></a></h3>
<p>Returns the binary product ID of this board.  It is a little-endian 32-bit word.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0xc0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe9</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 4</p></li>
</ul>
<p>This word has the following bitfields:</p>
<ul class="simple">
<li><p>bits 0-7: firmware identifier</p></li>
<li><p>bits 8-19: variant identifier</p></li>
<li><p>bits 20-31: product identifier</p></li>
</ul>
<p>The product identifier describes the particular board.  The variant identifier
describes its variant, such as what FPGA size has been fitted to it.</p>
</section>
<section id="get-secret-handshake">
<h3><code class="docutils literal notranslate"><span class="pre">GET_SECRET_HANDSHAKE</span></code><a class="headerlink" href="#get-secret-handshake" title="Link to this heading"></a></h3>
<p>Gets a secret 32-bit handshake number from the board.  This is a strong
cryptographic protocol used to verify the board as a genuine Digilent product.
A secret 16-bit nonce must first be set via the <code class="docutils literal notranslate"><span class="pre">SET_SECRET_HANDSHAKE</span></code>
request, then this request must be used to get a 32-bit MAC from the device.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bmRequestType</span></code>: <code class="docutils literal notranslate"><span class="pre">0xc0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bRequest</span></code>: <code class="docutils literal notranslate"><span class="pre">0xe9</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wValue</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wIndex</span></code>: 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wLength</span></code>: 4</p></li>
</ul>
<p>To verify the device as a genuine Digilent board, check the MAC is correct
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="n">correct_mac</span><span class="p">(</span><span class="n">nonce</span><span class="p">:</span> <span class="n">u16</span><span class="p">,</span> <span class="n">mac</span><span class="p">:</span> <span class="n">u32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">byte_nonce</span> <span class="o">=</span> <span class="p">(((</span><span class="n">nonce</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">^</span> <span class="n">nonce</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="k">as</span> <span class="n">u32</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">DIGILENT_PUBLIC_KEY</span><span class="p">:</span> <span class="n">u32</span> <span class="o">=</span> <span class="mh">0x69676944</span><span class="p">;</span>
    <span class="n">mac</span> <span class="o">==</span> <span class="p">(</span><span class="n">DIGILENT_PUBLIC_KEY</span> <span class="o">^</span> <span class="p">(</span><span class="n">byte_nonce</span> <span class="o">|</span> <span class="n">byte_nonce</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">byte_nonce</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="n">byte_nonce</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="subsystem-commands">
<h2>Subsystem commands<a class="headerlink" href="#subsystem-commands" title="Link to this heading"></a></h2>
<p>All commands other than the above control requests are handled via a uniform
protocol over endpoints 1-4.  Commands are targetted to particular “subsystem”
and a particular “port” (or, in other words, instance) of that subsystem.
The following subsystems can exist:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code>: SYS (manages other subsystems, always present, always 1 “port”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x01</span></code>: DMGT (general board management, always present, always 1 “port”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x02</span></code>: DJTG (JTAG, bit 0 in <code class="docutils literal notranslate"><span class="pre">GET_CAPS</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x03</span></code>: DPIO (simple GPIO, bit 1 in <code class="docutils literal notranslate"><span class="pre">GET_CAPS</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x04</span></code>: DEPP (EPP-like parallel port, bit 2 in <code class="docutils literal notranslate"><span class="pre">GET_CAPS</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x06</span></code>: DSPI (SPI, bit 4 in <code class="docutils literal notranslate"><span class="pre">GET_CAPS</span></code>)</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>list incomplete</p>
</div>
<p>Commands are sent on endpoint 1, and have the following general format:</p>
<ul class="simple">
<li><p>byte 0: command length in bytes, minus one</p></li>
<li><p>byte 1: target subsystem</p></li>
<li><p>byte 2:</p>
<ul>
<li><p>bits 0-6: command type</p></li>
<li><p>bit 7:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code>: this is a short command, or the start of a long command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code>: this is the end of a long command</p></li>
</ul>
</li>
</ul>
</li>
<li><p>byte 3: target port (if not applicable, set to 0)</p></li>
<li><p>bytes 4 and up (if any): short payload, determined by subsystem and command type</p></li>
</ul>
<p>Responses to commands are received on endpoint 2, and have the following general format:</p>
<ul class="simple">
<li><p>byte 0: response length in bytes, minus one</p></li>
<li><p>byte 1:</p>
<ul>
<li><p>bits 0-5: status code</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code>: success, payload determined by command type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x01</span></code>: command not supported (no payload)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x03</span></code>: resource in use (attempt to enable a port that is already enabled, or that uses resources shared with another enabled port), no payload</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x04</span></code>: port disabled error (attempt to send a non-enable command to disabled port), no payload</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x05</span></code>: DEPP address timeout (no payload)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x06</span></code>: DEPP data timeout</p>
<ul>
<li><p>payload: 32-bit number (unknown semantics)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0d</span></code>: command parameter out of range (no payload)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x31</span></code>: unknown subsystem (no payload)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x32</span></code>: unknown command (no payload)</p></li>
</ul>
</li>
<li><p>bit 6: if set, a “received byte count” field is present in the reply</p></li>
<li><p>bit 7: if set, a “transmitted byte count” field is present in the reply</p></li>
</ul>
</li>
<li><p>bytes 2 and up (if any): several packed fields, in order:</p>
<ul>
<li><p>if status code is non-0: error payload specific to status code</p></li>
<li><p>if bit 7 of byte 1 set: a 32-bit word containing “transmitted byte count” (the number of bytes sent over OUT EP3 for a long command)</p></li>
<li><p>if bit 6 of byte 1 set: a 32-bit word containing “received byte count” (the number of bytes sent over IN EP4 for a long command)</p></li>
<li><p>if status code is 0: short response payload, determined by subsystem and command type</p></li>
</ul>
</li>
</ul>
<p>Commands and responses are short and fit in one USB packet, which can be at most 16 bytes for the relevant endpoints.</p>
<p>Commands come in two kinds: short and long.  Whether a command is short
or long depends only on its subsystem and command type.  A short command
simply consists of two USB transfers:</p>
<ul class="simple">
<li><p>OUT EP1: command to device</p></li>
<li><p>IN EP2: response from device</p></li>
</ul>
<p>A long command is one that possibly takes a long time and can be aborted (via the <code class="docutils literal notranslate"><span class="pre">SYS_ABORT</span></code> command).
Long commands can also involve large data transfers over endpoints 3 and 4.  A long consists of the following transfers:</p>
<ul class="simple">
<li><p>OUT EP1: start command to device (bit 7 of byte 2 set to 0; short payload contains command arguments, if any)</p></li>
<li><p>IN EP2: response from device (if not successful, the command is aborted now)</p></li>
<li><p>OUT EP3 and/or IN EP4 (if needed): large payload to/from device (if both are needed, the two transfers may have to be overlapped)</p></li>
<li><p>OUT EP1: end command to device (bit 7 of byte 2 set to 1; no short payload present)</p></li>
<li><p>IN EP2: response from device (contains actual transmitted and received byte counts, as appropriate)</p></li>
</ul>
</section>
<section id="system-management-commands">
<h2>System management commands<a class="headerlink" href="#system-management-commands" title="Link to this heading"></a></h2>
<p>The “subsystem” 0 (“SYS”) is special, always present, and always enabled.</p>
<section id="sys-abort-command">
<h3><code class="docutils literal notranslate"><span class="pre">SYS_ABORT</span></code> command<a class="headerlink" href="#sys-abort-command" title="Link to this heading"></a></h3>
<p>This command can be sent in the middle of a long command to abort the transfer.</p>
<ul class="simple">
<li><p>subsystem: <code class="docutils literal notranslate"><span class="pre">0x00</span></code> (SYS)</p></li>
<li><p>command type: <code class="docutils literal notranslate"><span class="pre">0x02</span></code> (short)</p></li>
<li><p>port: N/A, always 0</p></li>
<li><p>command payload: none</p></li>
<li><p>response payload: none</p></li>
</ul>
</section>
<section id="sys-reset-command">
<h3><code class="docutils literal notranslate"><span class="pre">SYS_RESET</span></code> command<a class="headerlink" href="#sys-reset-command" title="Link to this heading"></a></h3>
<p>This command can be sent at any time to reset the current state of the device.
This involves disabling all ports.</p>
<ul class="simple">
<li><p>subsystem: <code class="docutils literal notranslate"><span class="pre">0x00</span></code> (SYS)</p></li>
<li><p>command type: <code class="docutils literal notranslate"><span class="pre">0x03</span></code> (short)</p></li>
<li><p>port: N/A, always 0</p></li>
<li><p>command payload: 32-bit word</p></li>
<li><p>response payload: 32-bit word</p></li>
</ul>
<p>For unknown reasons, this command takes a 32-bit word payload, and returns as the response payload another 32-bit word, which is equal to <code class="docutils literal notranslate"><span class="pre">0x7a</span> <span class="pre">-</span> <span class="pre">command_payload</span></code>.</p>
</section>
</section>
<section id="general-subsystem-commands">
<h2>General subsystem commands<a class="headerlink" href="#general-subsystem-commands" title="Link to this heading"></a></h2>
<p>These commands apply to all supported subsystems except <code class="docutils literal notranslate"><span class="pre">SYS</span></code> and <code class="docutils literal notranslate"><span class="pre">DMGT</span></code>.</p>
<section id="enable-command">
<h3><code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> command<a class="headerlink" href="#enable-command" title="Link to this heading"></a></h3>
<p>This command enables a subsystem port, making it ready for use.  The only
commands that can be sent to a disabled port are <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> and
<code class="docutils literal notranslate"><span class="pre">GET_CAPABILITIES</span></code>.  All ports start out as disabled.  A port will fail
to enable if it is already enabled, or if another port using the same hardware
resources is currently enabled.</p>
<ul class="simple">
<li><p>subsystem: any except SYS and DMGT</p></li>
<li><p>command type: <code class="docutils literal notranslate"><span class="pre">0x00</span></code> (short)</p></li>
<li><p>port: port index</p></li>
<li><p>command payload: none</p></li>
<li><p>response payload: none</p></li>
</ul>
</section>
<section id="disable-command">
<h3><code class="docutils literal notranslate"><span class="pre">DISABLE</span></code> command<a class="headerlink" href="#disable-command" title="Link to this heading"></a></h3>
<p>Disables a subsystem port, undoing the <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> command.</p>
<ul class="simple">
<li><p>subsystem: any except SYS and DMGT</p></li>
<li><p>command type: <code class="docutils literal notranslate"><span class="pre">0x01</span></code> (short)</p></li>
<li><p>port: port index</p></li>
<li><p>command payload: none</p></li>
<li><p>response payload: none</p></li>
</ul>
</section>
<section id="get-port-properties-command">
<h3><code class="docutils literal notranslate"><span class="pre">GET_PORT_PROPERTIES</span></code> command<a class="headerlink" href="#get-port-properties-command" title="Link to this heading"></a></h3>
<p>Returns the properties of a given port of a subsystem, and also the available port count.</p>
<ul class="simple">
<li><p>subsystem: any except SYS and DMGT</p></li>
<li><p>command type: <code class="docutils literal notranslate"><span class="pre">0x02</span></code> (short)</p></li>
<li><p>port: port index; call with port 0 to obtain number of available ports</p></li>
<li><p>command payload: 1 byte: requested data byte count (can be 1 or 5)</p></li>
<li><p>response payload:</p>
<ul>
<li><p>byte 0: port count</p></li>
<li><p>bytes 1-4 (if requested): 32-bit word, port properties; exact meaning depends on subsystem</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Digilent Adept Programmers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dmgt.html" class="btn btn-neutral float-right" title="DMGT: Management subsystem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Wanda.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>