<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Block RAM - Project Combine</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Project Combine</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="block-ram"><a class="header" href="#block-ram">Block RAM</a></h1>
<p>There are several closely related BRAM tiles described here:</p>
<ul>
<li>the Virtex 2 <code>BRAM</code> tile, containing:
<ul>
<li>the <code>BRAM</code> bel, implementing the <code>RAMB16_*</code> library primitives</li>
<li>the <code>MULT</code> bel, implementing the <code>MULT18X18</code> and <code>MULT18X18S</code> library primitives</li>
</ul>
</li>
<li>the Spartan 3 <code>BRAM.S3</code> tile, containing:
<ul>
<li>the <code>BRAM</code> bel, nearly identical to the Virtex 2 one</li>
<li>the <code>MULT</code> bel, identical to the Virtex 2 one</li>
</ul>
</li>
<li>the Spartan 3E <code>BRAM.S3E</code> tile, containing:
<ul>
<li>the <code>BRAM</code> bel, nearly identical to the Spartan 3 one</li>
<li>the upgraded <code>MULT</code> bel, implementing the <code>MULT18X18SIO</code> primitive</li>
</ul>
</li>
<li>the Spartan 3A <code>BRAM.S3A</code> tile, containing:
<ul>
<li>the upgraded <code>BRAM</code> bel, implementing the <code>RAMB16BWE_*</code> library primitives in addition to the old ones</li>
<li>the <code>MULT</code> bel, functionally identical to the Spartan 3E one, but with added input multiplexers allowing bypassing <code>BRAM</code> data output directly to multiplier inputs</li>
</ul>
</li>
<li>the Spartan 3A DSP <code>BRAM.S3ADSP</code> tile, containing:
<ul>
<li>the upgraded <code>BRAM</code> bel, implementing the <code>RAMB16BWER</code> library primitive</li>
<li>no <code>MULT</code> bel — it has been functionally replaced by the <code>DSP</code> tile</li>
</ul>
</li>
</ul>
<p>The <code>BRAM</code> tile corresponds to four vertically stacked interconnect tiles. They are:</p>
<ul>
<li>Virtex 2: four <code>INT.BRAM</code> tiles</li>
<li>Spartan 3: four <code>INT.BRAM.S3</code> tiles</li>
<li>Spartan 3E: four <code>INT.BRAM.S3E</code> tiles</li>
<li>Spartan 3A:
<ul>
<li>row 0 (bottom) and 3 (top): <code>INT.BRAM.S3A.03</code> tiles</li>
<li>rows 1 and 2: <code>INT.BRAM.S3A.12</code> tiles</li>
</ul>
</li>
<li>Spartan 3A DSP: four <code>INT.BRAM.S3ADSP</code> tiles</li>
</ul>
<p>The <code>BRAM</code> tile is interconnect-limitted in two ways:</p>
<ul>
<li>
<p>inputs <code>MULT.B0</code> through <code>MULT.B15</code> are shared with <code>BRAM.DIB16</code> through <code>BRAM.DIB31</code> (so it is not really possible to use the multiplier when both BRAM ports are used for writing with 36-bit data width, except when the <code>BCIN</code> cascade is used, or on Spartan 3A when the bypass path is used)</p>
</li>
<li>
<p>each interconnect tile is limitted (through <code>OMUX</code> bottleneck) to 24 out of 28 output wires; the exact rules are very non-obvious, but effectively the following can be supported:</p>
<ul>
<li><code>BRAM</code> with full data output (36-bit on both ports), no <code>MULT</code></li>
<li><code>BRAM</code> with full data output (36-bit) on one port, up to 18-bit on the other, <code>MULT</code> with full (36-bit) output</li>
<li><code>BRAM</code> with 32-bit data output on both ports  (no parity bits), <code>MULT</code> with 32-bit output</li>
</ul>
<p>If the Spartan 3A <code>MULT</code> bypass path is used, it doesn't count to the above restrictions.</p>
</li>
</ul>
<p>Since the <code>MULT</code> bel is gone on Spartan 3A DSP, its <code>BRAM</code> tile is not interconnect-limitted.</p>
<h2 id="the-bram-bel"><a class="header" href="#the-bram-bel">The <code>BRAM</code> bel</a></h2>
<p>The <code>BRAM</code> bel implements a 18-kbit block RAM, consisting of 16-kbit main plane and 2-kbit parity plane. Its operation is mostly described in the Xilinx documentation. However, the pin mapping of library primitives to the hardware bel is not obvious.</p>
<p>The bel has the following input pins, all of which are connected through general interconnect:</p>
<ul>
<li><code>CLK[AB]</code> (freely invertible through the interconnect): clocks for port A and port B</li>
<li><code>EN[AB]</code> (freely invertible through the interconnect): enable for port A and port B</li>
<li>(Virtex 2, Spartan 3, Spartan 3E, Spartan 3A) <code>SSR[AB]</code> (freely invertible through the interconnect): synchronous set/reset for the read ports</li>
<li>(Spartan 3A DSP) <code>RST[AB]</code> (freely invertible through the interconnect): set/reset for the read ports (synchronous or not); replaces <code>SSR[AB]</code></li>
<li>(Spartan 3A DSP) <code>REGCE[AB]</code> (freely invertible through the interconnect): pipeline register clock enable for read ports</li>
<li>(Virtex 2, Spartan 3, Spartan 3E) <code>WE[AB]</code> (freely invertible through the interconnect): write enable for port A and port B</li>
<li>(Spartan 3A, Spartan 3A DSP) <code>WE[AB][0-3]</code> (freely invertible through the interconnect): per-byte write enable for port A and port B</li>
<li><code>ADDR[AB]0</code> through <code>ADDR[AB]13</code>, the address buses for port A and port B</li>
<li><code>DI[AB]0</code> through <code>DI[AB]31</code>: the main data input for port A and port B</li>
<li><code>DIP[AB]0</code> through <code>DIP[AB]3</code>: the parity data input for port A and port B</li>
</ul>
<p>The bel has the following output pins, all of which are connected through general interconnect:</p>
<ul>
<li><code>DO[AB]0</code> through <code>DO[AB]31</code>: the main data output for port A and port B</li>
<li><code>DOP[AB]0</code> through <code>DOP[AB]3</code>: the parity data output for port A and port B</li>
</ul>
<p>The address buses are always in terms of (main plane) bits. When port widths wider than one bit are used, the low bits of the address are unused. When port widths smaller than 36 bits are used, the high bits of the data input/output ports are unused.</p>
<p>On Spartan 3A and 3A DSP, the write enables are per byte. The <code>WE[AB][0-3]</code> ports should be connected as follows:</p>
<ul>
<li>for port width of 9 or smaller, the same signal (the single write enable) should be connected to all 4 bits of the write enable</li>
<li>for port width of 18:
<ul>
<li>write enable signal 0 (for lower byte) should be connected to both <code>WE[AB]0</code> and <code>WE[AB]2</code></li>
<li>write enable signal 1 (for upper byte) should be connected to both <code>WE[AB]1</code> and <code>WE[AB]3</code></li>
</ul>
</li>
</ul>
<p>The bel has the following bitstream attributes:</p>
<ul>
<li><code>DATA_WIDTH_[AB]</code> selects the width of the given port; the values are:
<ul>
<li><code>1</code>: <code>D[IO][AB]0</code> is used for data, <code>ADDR[AB][0-13]</code> is used for address</li>
<li><code>2</code>: <code>D[IO][AB][01]</code> is used for data, <code>ADDR[AB][1-13]</code> is used for address</li>
<li><code>4</code>: <code>D[IO][AB][0-3]</code> is used for data, <code>ADDR[AB][2-13]</code> is used for address</li>
<li><code>9</code>: <code>D[IO][AB][0-7]</code> and <code>D[IO]P[AB]0</code> are used for data, <code>ADDR[AB][3-13]</code> is used for address</li>
<li><code>18</code>: <code>D[IO][AB][0-15]</code> and <code>D[IO]P[AB][01]</code> are used for data, <code>ADDR[AB][4-13]</code> is used for address</li>
<li><code>36</code>: <code>D[IO][AB][0-31]</code> and <code>D[IO]P[AB][0-3]</code> are used for data, <code>ADDR[AB][5-13]</code> is used for address</li>
</ul>
</li>
<li><code>WRITE_MODE_[AB]</code>: selects behavior of the read port when writing, the values are:
<ul>
<li><code>WRITE_FIRST</code>: data output shows just-written data</li>
<li><code>READ_FIRST</code>: data output shows data previously in memory at the given address</li>
<li><code>NO_CHANGE</code>: the data output is unchanged from previous cycle</li>
</ul>
</li>
<li><code>SRVAL_[AB]</code> (36-bit value): selects the set/reset value of the read port; the low 32 bits correspond to <code>DO[AB][0-31]</code> while the high 4 bits correspond to <code>DOP[AB][0-3]</code></li>
<li><code>INIT_[AB]</code> (36-bit value): selects the initial value of the read port; the low 32 bits correspond to <code>DO[AB][0-31]</code> while the high 4 bits correspond to <code>DOP[AB][0-3]</code></li>
<li>(Spartan 3A DSP) <code>RSTTYPE</code> : selects reset mode, either <code>SYNC</code> or <code>ASYNC</code></li>
<li>(Spartan 3A DSP) <code>DO[AB]_REG</code> : selects number of pipeline registers for read port
<ul>
<li><code>0</code>: no pipeline registers, just output latches; same behavior as older FPGAs</li>
<li><code>1</code>: one additional pipeline register on the read port</li>
</ul>
</li>
<li><code>DATA</code> (16384-bit value): the initial data for the BRAM main plane; corresponds to concatenation of <code>INIT_xx</code> primitive attributes</li>
<li><code>DATAP</code> (2048-bit value): the initial data for the BRAM parity plane; corresponds to concatenation of <code>INITP_xx</code> primitive attributes</li>
<li>(Virtex 2) <code>SAVEDATA</code> (64-bit value): if set, the BRAM data will not be written during partial reconfiguration; the attribute has one bit per frame of the bitstream BRAM data tile</li>
<li>(Spartan 3 and up) <code>WW_VALUE_[AB]</code>: unknown purpose, must be set to <code>NONE</code></li>
<li>(Spartan 3 and up) <code>WDEL_A</code> (3-bit value): unknown purpose, must be set to device-dependent value from the table below</li>
<li>(Spartan 3 and up) <code>DDEL_A</code> (2-bit value): unknown purpose, must be set to device-dependent value from the table below</li>
<li>(Spartan 3E and up) <code>WDEL_B</code> (3-bit value): unknown purpose, must be set to device-dependent value from the table below</li>
<li>(Spartan 3E and up) <code>DDEL_B</code> (2-bit value): unknown purpose, must be set to device-dependent value from the table below</li>
<li>(Spartan 3A, Spartan 3A DSP) <code>UNK_PRESENT</code> (2-bit value): unknown purpose, must be set to all-1</li>
</ul>
<p>TODO: the <code>RSTTYPE</code> attribute takes two bits in the bitstream, there's a good chance it's actually per-port</p>
<p>TODO: <code>UNK_PRESENT</code></p>
<p>TODO: exact semantics of <code>SAVEDATA</code> are unclear</p>
<h2 id="the-mult-bel--virtex-2-and-spartan-3"><a class="header" href="#the-mult-bel--virtex-2-and-spartan-3">The <code>MULT</code> bel — Virtex 2 and Spartan 3</a></h2>
<p>The <code>MULT</code> bel implements a 18×18 signed multiplier with an optional register.
It corresponds to the <code>MULT18X18</code> and <code>MULT18X18S</code> library primitives.</p>
<p>The bel has the following general interconnect inputs:</p>
<ul>
<li><code>CLK</code> (freely invertible via interconnect): the clock</li>
<li><code>CE</code> (freely invertible via interconnect): the clock enable</li>
<li><code>RST</code> (freely invertible via interconnect): the synchronous reset signal (sets the register to all-0)</li>
<li><code>A[0-17]</code>: first input</li>
<li><code>B[0-17]</code>: second input</li>
</ul>
<p>The bel has a single general interconnect output:</p>
<ul>
<li><code>P[0-35]</code>: output</li>
</ul>
<p>The bel has a single attribute:</p>
<ul>
<li><code>REG</code>:
<ul>
<li>if set, the multiplier is in synchronous mode, implementing the <code>MULT18X18S</code> primitive</li>
<li>if unset, the multiplier is in combinational mode, implementing the <code>MULT18X18</code> primitive; the <code>CLK</code>, <code>RST</code> and <code>CE</code> inputs are unused</li>
</ul>
</li>
</ul>
<p>The semantics of the primitive is pretty simple: it computes <code>A * B</code>, either combinationally or with an output register.</p>
<h2 id="the-mult-bel--spartan-3e-and-spartan-3a"><a class="header" href="#the-mult-bel--spartan-3e-and-spartan-3a">The <code>MULT</code> bel — Spartan 3E and Spartan 3A</a></h2>
<p>The <code>MULT</code> bel implements a 18×18 signed multiplier with optional registers on inputs and output.
It corresponds to the <code>MULT18X18SIO</code> library primitive (and can also support the older primitives in an obvious way).</p>
<p>The bel has the following general interconnect inputs:</p>
<ul>
<li><code>CLK</code> (freely invertible via interconnect): the clock</li>
<li><code>CE[ABP]</code> (freely invertible via interconnect): the clock enables</li>
<li><code>RST[ABP]</code> (freely invertible via interconnect): the synchronous reset signals (sets the corresponding register to all-0)</li>
<li><code>A[0-17]</code>: first input</li>
<li><code>B[0-17]</code>: second input</li>
</ul>
<p>On Spartan 3A, the <code>A</code> and <code>B</code> inputs can be switched (per-bit) between general interconnect and bypass from the corresponding <code>DOA</code> or <code>DOB</code> output from the colocated <code>BRAM</code> bel.</p>
<p>The bel has a single general interconnect output:</p>
<ul>
<li><code>P[0-35]</code>: output</li>
</ul>
<p>The bel also has special pins connected via dedicated interconnect:</p>
<ul>
<li><code>BCOUT[0-17]</code>: cascade output; mirrors the <code>B</code> or <code>BCIN</code> input (if <code>BREG == 0</code>), or the <code>B</code> register output (if <code>BREG == 1</code>)</li>
<li><code>BCIN[0-17]</code>: cascade input; routed from <code>BCOUT</code> of the <code>MULT</code> in the tile immediately below; can be used instead of the <code>B</code> input to save up on routing resources</li>
</ul>
<p>When the BRAM column has a hole (for a DCM), the cascade chain jumps over the hole.</p>
<p>The bel has the following attributes:</p>
<ul>
<li><code>AREG</code>: selects the number of pipeline registers on the <code>A</code> input; either <code>0</code> or <code>1</code></li>
<li><code>BREG</code>: selects the number of pipeline registers on the <code>B</code> or <code>BCIN</code> input; either <code>0</code> or <code>1</code></li>
<li><code>PREG</code>: selects the number of pipeline registers on the <code>P</code> output; either <code>0</code> or <code>1</code></li>
<li><code>B_INPUT</code>: selects the second input to the multiplier
<ul>
<li><code>DIRECT</code>: uses the general interconnect <code>B</code> input</li>
<li><code>CASCADE</code>: uses the dedicated <code>BCIN</code> input</li>
</ul>
</li>
<li><code>PREG_CLKINVERSION</code>: if set, the clock to the <code>P</code> register is inverted from <code>CLK</code></li>
<li>(Spartan 3A) <code>[AB][0-17]MUX</code>: selects where the corresponding input pin comes from:
<ul>
<li><code>INT</code>: general interconnect</li>
<li><code>BRAM</code>: bypass from <code>BRAM</code> outputs
<ul>
<li><code>[AB][0-15]</code> are bypassed from <code>DO[AB][0-15]</code></li>
<li><code>[AB][16-17]</code> are bypassed from <code>DOP[AB][0-1]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The semantics of the primitive are as follows:</p>
<ul>
<li><code>A_Q = (AREG == 1 ? ff(A, CLK, CEA, RSTA) : A)</code></li>
<li><code>B_MUX = (B_INPUT == "CASCADE" ? BCIN : B)</code></li>
<li><code>B_Q = BCOUT = (BREG == 1 ? ff(B_MUX, CLK, CEB, RSTB) : B_MUX)</code></li>
<li><code>P_D = A_Q * B_Q</code></li>
<li><code>P = (PREG == 1 ? ff(P_D, CLK ^ PREG_CLKINVERSION, CEP, RSTP) : P_D)</code></li>
<li><code>ff(d, clk, ce, rst)</code> signifies a flip-flop with synchronous reset and reset-over-CE priority</li>
</ul>
<p>TODO: <code>PREG_CLKINVERSION</code> is not documented by Xilinx nor exposed via library primitive; test it</p>
<h2 id="bitstream"><a class="header" href="#bitstream">Bitstream</a></h2>
<p>For the Spartan 3 (and up) tiles, see <a href="../spartan3/bram.html">Spartan 3 BRAM</a>.</p>
<p>The data for a BRAM is spread across 5 bitstream tiles:</p>
<ul>
<li>tiles 0-3: the 4 bitstream tiles that are shared with the <code>INT.BRAM</code> interconnect tiles (starting from the bottom)</li>
<li>tile 4: the dedicated BRAM data tile located in the BRAM data area; this tile is 64×320 bits; it contains solely the <code>DATA</code>, <code>DATAP</code>, and <code>SAVEDATA</code> attributes</li>
</ul>
<p>{{tile virtex2 BRAM}}</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../virtex2/clb.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../virtex2/clock/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../virtex2/clb.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../virtex2/clock/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
