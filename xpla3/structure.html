<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Device structure &mdash; Project Combine  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bitstream structure" href="bitstream.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Project Combine
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../xc9500/index.html">Xilinx XC9500, XC9500XL, XC9500XV CPLDs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Xilinx XPLA3 CPLDs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Device structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fb-columns-and-rows">FB columns and rows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zia-and-fb-inputs">ZIA and FB inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fclk-networks">FCLK networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#product-terms">Product terms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#local-control-terms">Local control terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#universal-control-terms">Universal control terms</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sum-term-lut2">Sum term, LUT2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#register">Register</a></li>
<li class="toctree-l3"><a class="reference internal" href="#macrocell-and-iob-outputs">Macrocell and IOB outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-output-buffer">Input/output buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#misc-configuration">Misc configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bitstream.html">Bitstream structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="database.html">Database schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="db-devices.html">Database — devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="jtag.html">JTAG interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../xc2c/index.html">Xilinx Coolrunner II CPLDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xcv/index.html">Xilinx Virtex, Virtex E, Spartan 2, Spartan 2E FPGAs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xc2v/index.html">Xilinx Virtex 2 and Spartan 3 FPGAs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xc4v/index.html">Xilinx Virtex 4 FPGAs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xc5v/index.html">Xilinx Virtex 5 FPGAs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xc6v/index.html">Xilinx Virtex 6 FPGAs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Project Combine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Xilinx XPLA3 CPLDs</a></li>
      <li class="breadcrumb-item active">Device structure</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/xpla3/structure.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="device-structure">
<h1>Device structure<a class="headerlink" href="#device-structure" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>An XPLA3 device is made of:</p>
<ul class="simple">
<li><p>the ZIA (Zero-power Interconnect Array), which routes various signals to FB inputs; the routable signals include:</p>
<ul>
<li><p>MC outputs</p></li>
<li><p>IOB outputs (ie. input buffers from general purpose I/O)</p></li>
<li><p>GCLK input buffers</p></li>
<li><p>a special POR (power-on reset) signal that is pulsed at device startup</p></li>
</ul>
</li>
<li><p>2-32 FBs (function blocks), each of which has:</p>
<ul>
<li><p>two <code class="docutils literal notranslate"><span class="pre">FCLK[i]</span></code> fast clock networks, routable from <code class="docutils literal notranslate"><span class="pre">GCLK</span></code> pads</p></li>
<li><p>40 routable inputs from ZIA</p></li>
<li><p>48 PTs (product terms) shared between all MCs, each of them having one special function that can be used
instead of (or in addition to) being included in MC sum terms:</p>
<ul>
<li><p>PT0-7: directly (with programmable inversion) drive LCTs (local control terms), which can be routed to control
inputs of all MCs within this FB; the possible uses of each LCT include:</p>
<ul>
<li><p>LCT0-2: RST/SET, OE</p></li>
<li><p>LCT3: RST/SET</p></li>
<li><p>LCT4: CLK, RST/SET, CE</p></li>
<li><p>LCT5: CLK, RST/SET</p></li>
<li><p>LCT6: CLK, OE, UCTs (on XCR3032XL only)</p></li>
<li><p>LCT7: CLK, UCTs</p></li>
</ul>
</li>
<li><p>PT8-38 (even): fast data input to MC0-15, respectively</p></li>
<li><p>PT9-39 (off): dedicated CLK or CE input to MC0-15, respectively</p></li>
<li><p>PT40-47: foldback NANDs, the PT outputs are inverted and fed back as possible inputs to all PTs in this FB</p></li>
</ul>
</li>
<li><p>16 MCs (macrocells), each of which has:</p>
<ul>
<li><p>a sum term, including an arbitrary subset of this FB’s PTs</p></li>
<li><p>a LUT2 implementing an arbitrary function of the sum term and the fast data input PT</p></li>
<li><p>a register, with:</p>
<ul>
<li><p>D input tied to either the LUT2 output, or this MC’s input buffer (sidestepping the ZIA)</p></li>
<li><p>configurable mode, one of: DFF, TFF, D latch, DFF with clock enable</p></li>
<li><p>clock (or latch gate), freely invertible and routable from LCT4-7, FCLK0-1, dedicated per-MC PT, or UCT0</p></li>
<li><p>async set and reset, both routable from LCT0-5, UCT2 (set), UCT3 (reset), or const 0</p></li>
<li><p>clock enable, routable from LCT4 or dedicated per-MC PT</p></li>
<li><p>always 0 initial value</p></li>
</ul>
</li>
<li><p>output to ZIA, routed either from the LUT2 (combinatorial) or the register’s Q output (registered)</p></li>
<li><p>IOB (input/output buffer) (on larger devices, not all MCs have an IOB), with:</p>
<ul>
<li><p>input buffer (routed to ZIA and this MC’s register D input)</p></li>
<li><p>output to ZIA, routed either from the input buffer or from the MC’s register Q output</p></li>
<li><p>either combinatorial (from LUT2) or registered (from register’s Q) output to the output buffer, selectable
independently from ZIA output</p></li>
<li><p>output enable, routable from LCT0-2, LCT6, UCT1, const 0, const 1</p></li>
<li><p>optional pull-up (can only be used when OE is tied to 0)</p></li>
<li><p>configurable slew rate (fast or slow)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>global signals</p>
<ul>
<li><p>the 4 GCLK dedicated inputs, routable to ZIA and per-FB <code class="docutils literal notranslate"><span class="pre">FCLK</span></code> networks</p></li>
<li><p>the 4 UCTs (Universal Control Terms), routable from LCT7 of all FBs (and, on XCR3032XL, also LCT6 of all FBs);
UCTs can be used to drive control signals throughout the whole device:</p>
<ul>
<li><p>UCT0: CLK</p></li>
<li><p>UCT1: OE</p></li>
<li><p>UCT2: RST</p></li>
<li><p>UCT3: SET</p></li>
</ul>
</li>
</ul>
</li>
<li><p>special global configuration bits</p>
<ul>
<li><p>JTAG pins disable bit (if not programmed, the IOBs corresponding to JTAG pins are connected to the TAP instead of their MCs)</p></li>
<li><p>user electronic signature bits (free-form field, size varies with device)</p></li>
<li><p>read protection enable</p></li>
</ul>
</li>
</ul>
</section>
<section id="fb-columns-and-rows">
<h2>FB columns and rows<a class="headerlink" href="#fb-columns-and-rows" title="Link to this heading"></a></h2>
<p>The FBs in the device are organized in a 2D structure of columns and rows.</p>
<p>Each FB column has its own branch of the ZIA, and actually contains two FBs per row:
one on each side of the ZIA.  The FBs are nubered as follows:</p>
<ul class="simple">
<li><p>Even-numbered FBs are on one side of the ZIA branch of their column, and odd-numbered are on
the other</p></li>
<li><p>When increasing FB number from odd to even, move to the next FB row</p></li>
<li><p>If already at the last FB row, move to the next FB column and first FB row</p></li>
</ul>
<p>For example, the xcr3384xl device is organized as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head" colspan="2"><p>Column 0</p></th>
<th class="head" colspan="2"><p>Column 1</p></th>
<th class="head" colspan="2"><p>Column 2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
<td><p>16</p></td>
<td><p>17</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>10</p></td>
<td><p>11</p></td>
<td><p>18</p></td>
<td><p>19</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>4</p></td>
<td><p>5</p></td>
<td><p>12</p></td>
<td><p>13</p></td>
<td><p>20</p></td>
<td><p>21</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>14</p></td>
<td><p>15</p></td>
<td><p>22</p></td>
<td><p>23</p></td>
</tr>
</tbody>
</table>
</section>
<section id="zia-and-fb-inputs">
<h2>ZIA and FB inputs<a class="headerlink" href="#zia-and-fb-inputs" title="Link to this heading"></a></h2>
<p>The core interconnect structure in XPLA3 devices is called ZIA, the Zero-power Interconnect Array.
It is a classic CPLD design.</p>
<p>Each FB has 40 inputs from ZIA, which we call <code class="docutils literal notranslate"><span class="pre">FB[i].IM[j]</span></code>.  Each FB input is controlled
by a set of fuses:</p>
<ul>
<li><p>mux fuses (<code class="docutils literal notranslate"><span class="pre">FB[i].IM[j].MUX</span></code>) select what is routed to the input.  The combinations include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">VCC</span></code>: the input is const 1 (for unused inputs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GND</span></code>: the input is const 0 (not very useful)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MC_{k}_{l}</span></code>: the input is routed from the macrocell output <code class="docutils literal notranslate"><span class="pre">FB[k].MC[l].MC_ZIA_OUT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IOB_{k}_{l}</span></code>: the input is routed from the macrocell output <code class="docutils literal notranslate"><span class="pre">FB[k].MC[l].IOB_ZIA_OUT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GCLK{i}</span></code>: the input is routed from the input buffer of dedicated <code class="docutils literal notranslate"><span class="pre">GCLK{i}</span></code> pin;
for this choice to work, the relevant <code class="docutils literal notranslate"><span class="pre">FB_COL[*].ZIA_GCLK{i}_ENABLE</span></code> fuse has to be enabled</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STARTUP</span></code>: the input is routed to the special <code class="docutils literal notranslate"><span class="pre">STARTUP</span></code> network</p></li>
</ul>
<p>The allowable combinations differ between inputs within a single FB, but don’t differ across
FBs within a single device.  In other words, the set of allowed values for these fuses
depends only on the <code class="docutils literal notranslate"><span class="pre">j</span></code> coordinate, but not on <code class="docutils literal notranslate"><span class="pre">i</span></code>.</p>
</li>
</ul>
<p>The ZIA lines corresponding to <code class="docutils literal notranslate"><span class="pre">GCLK*</span></code> inputs are gated, for the purpose for power saving.
The gating is per-FB column, and is controlled by the following fuses:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB_COL[i].ZIA_GCLK{j}_ENABLE</span></code>: if programmed, <code class="docutils literal notranslate"><span class="pre">GCLK{i}</span></code> can be routed through ZIA to FBs
within this column.  Otherwise, the <code class="docutils literal notranslate"><span class="pre">GCLK{i}</span></code> option above is non-functional and will result
in XXX.  Routing <code class="docutils literal notranslate"><span class="pre">GCLK*</span></code> to <code class="docutils literal notranslate"><span class="pre">FCLK*</span></code> is always possible, regardless of this fuse.</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>while ISE sets the fuse as if the above is true, disabling the fuse doesn’t actually seem to make ZIA GCLK routing not work. what’s going on?</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">STARTUP</span></code> net is a special device-wide net that is pulsed to <code class="docutils literal notranslate"><span class="pre">1</span></code> for a short time at device
initialization, then remains at <code class="docutils literal notranslate"><span class="pre">0</span></code> afterwards.  It can be connected as the <code class="docutils literal notranslate"><span class="pre">SET</span></code> input
to a register to effectively obtain a <code class="docutils literal notranslate"><span class="pre">1</span></code>-initialized register.</p>
</section>
<section id="fclk-networks">
<h2>FCLK networks<a class="headerlink" href="#fclk-networks" title="Link to this heading"></a></h2>
<p>Every FB has two fast clock nets, <code class="docutils literal notranslate"><span class="pre">FCLK[0-1]</span></code>.  They can be routed to the clock input
of every MC within the FB.  They can be routed from <code class="docutils literal notranslate"><span class="pre">GCLK*</span></code> input pads in many combinations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FCLK*</span></code> routing is selected by a single fuse set per FB that selects both inputs
at once:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].FCLK_MUX</span></code>: selects <code class="docutils literal notranslate"><span class="pre">FCLK*</span></code> routing for this FB.  The values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GCLK{j}_GCLK{k}</span></code>: routes <code class="docutils literal notranslate"><span class="pre">FCLK0</span></code> to <code class="docutils literal notranslate"><span class="pre">GCLK{j}</span></code> and <code class="docutils literal notranslate"><span class="pre">FCLK1</span></code> to <code class="docutils literal notranslate"><span class="pre">GCLK{k}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GCLK{j}_NONE</span></code>: routes <code class="docutils literal notranslate"><span class="pre">FCLK0</span></code> to <code class="docutils literal notranslate"><span class="pre">GCLK{j}</span></code> and <code class="docutils literal notranslate"><span class="pre">FCLK1</span></code> to const 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NONE_GCLK{j}</span></code>: routes <code class="docutils literal notranslate"><span class="pre">FCLK0</span></code> to const 0 and <code class="docutils literal notranslate"><span class="pre">FCLK1</span></code> to <code class="docutils literal notranslate"><span class="pre">GCLK{j}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NONE</span></code>: routes <code class="docutils literal notranslate"><span class="pre">FCLK[0-1]</span></code> to const 0</p></li>
</ul>
<p>See the database for the exact set of allowed values.</p>
</li>
</ul>
</section>
<section id="product-terms">
<h2>Product terms<a class="headerlink" href="#product-terms" title="Link to this heading"></a></h2>
<p>As the name suggests, XPLA3 has a PLA-like structure.  Each FB has 48 product terms, all of
which are routable to sum terms of all MCs within that FB.  We call them <code class="docutils literal notranslate"><span class="pre">FB[i].PT[j]</span></code>. In addition, each product term
also has a single dedicated function it can be used for:</p>
<ul class="simple">
<li><p>PTs 0-7 are used to derive Local Control Terms (LCTs), which can be routed to special inputs
of all MCs within the FB</p></li>
<li><p>PTs 8-38 (even) can be used as fast data input (D1) of MCs 0-15, respectively.  This data input
can be combined with the slower sum term input via a programmable LUT2.</p></li>
<li><p>PTs 9-39 (odd) can be used as dedicated clock or CE input to registers of MCs 0-15, respectively.</p></li>
<li><p>PTs 40-47 can be used for foldback NAND: the output of these product term is inverted and can
be further used as input to other product terms within the same FB.</p></li>
</ul>
<p>The inputs to all product terms within the FB are the same and include:</p>
<ul class="simple">
<li><p>the 40 <code class="docutils literal notranslate"><span class="pre">FB[i].IM[*]</span></code> signals, both true and negated</p></li>
<li><p>the 8 foldback NAND signals from the same FB, <code class="docutils literal notranslate"><span class="pre">FB[i].PT[40-47]</span></code>, negated only</p></li>
</ul>
<p>The fuses controlling a product term are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].PT[j].IM[k].P</span></code>: if programmed (set to 0), <code class="docutils literal notranslate"><span class="pre">FB[i].IM[k]</span></code> is included in the product term (true polarity)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].PT[j].IM[k].N</span></code>: if programmed (set to 0), <code class="docutils literal notranslate"><span class="pre">~FB[i].IM[k]</span></code> is included in the product term (inverted polarity)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].PT[j].FBN[k]</span></code>: if programmed (set to 0), <code class="docutils literal notranslate"><span class="pre">~FB[i].PT[40+k]</span></code> is included in the product term (foldback NAND, inverted polarity)</p></li>
</ul>
<section id="local-control-terms">
<h3>Local control terms<a class="headerlink" href="#local-control-terms" title="Link to this heading"></a></h3>
<p>Every FB has 8 LCTs (local control terms), which are derived from PT 0-7 respectively, via an optional inversion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LCT</span><span class="p">{</span><span class="n">j</span><span class="p">}</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">PT</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">^</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LCT</span><span class="p">{</span><span class="n">j</span><span class="p">}</span><span class="n">_INV</span>
</pre></div>
</div>
<p>The fuses controlling LCTs are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].LCT{j}_INV</span></code>: if programmed, LCT j is inverse of PT j; otherwise LCT j is equal to PT jed_to_jtag</p></li>
</ul>
<p>The LCTs can be used for the following purposes:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>LCT</p></th>
<th class="head"><p>CLK</p></th>
<th class="head"><p>RST</p></th>
<th class="head"><p>SET</p></th>
<th class="head"><p>CE</p></th>
<th class="head"><p>OE</p></th>
<th class="head"><p>UCT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
<td><p>*</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>X</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>X</p></td>
</tr>
</tbody>
</table>
<p>*: on XCR3032XL only</p>
</section>
<section id="universal-control-terms">
<h3>Universal control terms<a class="headerlink" href="#universal-control-terms" title="Link to this heading"></a></h3>
<p>The device has 4 UCTs (universal control terms).  On the XCR3032XL, all UCTs are routable
from LCT6 and LCT7 of all FBs.  On other devices, all the UCTs are routaeble from only LCT7 off
all FBs.</p>
<p>The UCTs can be routed to special inputs of all macrocells on the device.  They have fixed functions:</p>
<ul class="simple">
<li><p>UCT 0: can be routed to OE of all MCs</p></li>
<li><p>UCT 1: can be routed to RST of all MCs</p></li>
<li><p>UCT 2: can be routed to SET of all MCs</p></li>
<li><p>UCT 3: can be routed to CLK of all MCs</p></li>
</ul>
<p>The “universal” name is a slight misnomer.  On all devices other than XCR3512XL, the UCTs are truly
universal and cover the entire device.  However, on XCR3512XL, the FBs of the device are
divided into two FB groups, and each group has their own UCT muxes.  The vendor toolchain doesn’T
make use of this functionality and always mirrors UCT mux setting between the two groups.</p>
<p>The relevant fuse sets are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB_GROUP[i].UCT{j}</span></code>: selects the signal routed to <code class="docutils literal notranslate"><span class="pre">UCT{j}</span></code> of FB group <code class="docutils literal notranslate"><span class="pre">i</span></code> (all devices other than XCR3512XL have only FB group 0)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">FB{k}_LCT{l}</span></code>: the UCT is driven by the given LCT of the given FB</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NONE</span></code>: the UCT is unused and will be const-0</p></li>
</ul>
</li>
</ul>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>exact FB assignment to groups on XCR3512XL</p>
</div>
</section>
</section>
<section id="sum-term-lut2">
<h2>Sum term, LUT2<a class="headerlink" href="#sum-term-lut2" title="Link to this heading"></a></h2>
<p>Every MC in the device has a sum term, <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].SUM</span></code>, which can be constructed from all
product terms within the same FB.  Is is controlled by the following fuses:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].SUM.PT[k]</span></code>: if programmed (set to 0), <code class="docutils literal notranslate"><span class="pre">FB[i].PT[k]</span></code> is included in the sum term for <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j]</span></code></p></li>
</ul>
<p>The sum term, together with the fast input product term, are fed into a programmable LUT2 which
determines the given macrocell’s combinatorial output and can also be routed to the register’s
data input.  The LUT2 can be used for many purposes:</p>
<ul class="simple">
<li><p>select between the sum term and the fast product term</p></li>
<li><p>serve as a XOR or AND gate between the sum term and fast product term</p></li>
<li><p>perform inversion</p></li>
</ul>
<p>The LUT2 is controlled by a fuse set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].LUT</span></code>: a 4-bit fuse set configuring the LUT2</p></li>
</ul>
<p>The LUT2 works as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SUM</span> <span class="o">|</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">PT</span><span class="p">[</span><span class="mi">8</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
<span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LUT_OUT</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LUT</span><span class="p">[</span><span class="n">select</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="register">
<h2>Register<a class="headerlink" href="#register" title="Link to this heading"></a></h2>
<p>Each macrocell has a register.  It has:</p>
<ul class="simple">
<li><p>four modes of operation:</p>
<ul>
<li><p>DFF</p></li>
<li><p>TFF</p></li>
<li><p>D latch</p></li>
<li><p>DFF with clock enable</p></li>
</ul>
</li>
<li><p>D or T input routable from one of:</p>
<ul>
<li><p>LUT output</p></li>
<li><p>pad input buffer (so-called fast input register)</p></li>
<li><p>the Q output of the previous register in the FB (wrapping from 0 to 15) (so-called fast shift register)</p></li>
<li><p>the Q output of the next register in the FB (wrapping from 15 to 0) (so-called fast shift register)</p></li>
</ul>
</li>
<li><p>clock or gate input routable from one of:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">FCLK*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LCT[4-7]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT3</span></code></p></li>
<li><p>dedicated per-MC product term</p></li>
</ul>
</li>
<li><p>configurable inversion on the clock or gate input</p></li>
<li><p>(in DFF with clock enable mode only) clock enable input routable to one of:</p>
<ul>
<li><p>dedicated per-MC product term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LCT4</span></code></p></li>
</ul>
</li>
<li><p>asynchronous reset, routable from:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LCT[0-5]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT1</span></code></p></li>
<li><p>const-0</p></li>
</ul>
</li>
<li><p>asynchronous set, routable from:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LCT[0-5]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT2</span></code></p></li>
<li><p>const-0</p></li>
</ul>
</li>
<li><p>initial state of 0</p></li>
</ul>
<p>The fuses involved are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].CLK_MUX</span></code>: selects CLK input</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">PT</span></code>: dedicated product term <code class="docutils literal notranslate"><span class="pre">9</span> <span class="pre">+</span> <span class="pre">j</span> <span class="pre">*</span> <span class="pre">2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FCLK[0-1]</span></code>: per-FB <code class="docutils literal notranslate"><span class="pre">FCLK[0-1]</span></code> network</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LCTx</span></code>: per-FB local control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT3</span></code>: universal control term</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].CLK_INV</span></code>: if programmed, the CLK input is inverted (ie. clock is negedge)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].RST_MUX</span></code>: selects RST input</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LCTx</span></code>: per-FB local control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT1</span></code>: universal control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GND</span></code>: const 0</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].SET_MUX</span></code>: selects SET input</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LCTx</span></code>: per-FB local control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT1</span></code>: universal control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GND</span></code>: const 0</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].CE_MUX</span></code>: selects CE input (only relevant in <code class="docutils literal notranslate"><span class="pre">DFFCE</span></code> mode)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">PT</span></code>: dedicated product term <code class="docutils literal notranslate"><span class="pre">9</span> <span class="pre">+</span> <span class="pre">j</span> <span class="pre">*</span> <span class="pre">2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LCTx</span></code>: per-FB local control term</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].REG_MODE</span></code>: selects FF mode</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">DFF</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TFF</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LATCH</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DFFCE</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].REG_D_IREG</span></code>: if programmed, and the <code class="docutils literal notranslate"><span class="pre">REG_D_SHIFT</span></code> fuse is not programmed, the register D input is connected to <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].IOB.I</span></code>; if neither is programmed, the register D input is connected to <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].LUT_OUT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].REG_D_SHIFT</span></code>: if programmed, the register D input is connected to the previous or next MC’s register Q output; otherwise, the connection is determined by <code class="docutils literal notranslate"><span class="pre">REG_D_IREG</span></code> fuse</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].REG_D_SHIFT_DIR</span></code>: when the previous fuse is programmed, determines which MC’s register Q output is connected to this register’s D input</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">UP</span></code>: D input connected to <code class="docutils literal notranslate"><span class="pre">FB[i].MC[(j</span> <span class="pre">-</span> <span class="pre">1)</span> <span class="pre">%</span> <span class="pre">16].REG</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOWN</span></code>: D input connected to <code class="docutils literal notranslate"><span class="pre">FB[i].MC[(j</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">%</span> <span class="pre">16].REG</span></code></p></li>
</ul>
</li>
</ul>
<p>The register works as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK_MUX</span><span class="p">)</span>
<span class="n">PT</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">PT</span><span class="p">[</span><span class="mi">9</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span> <span class="o">^</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK_INV</span><span class="p">;</span>
<span class="n">LCTx</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LCTx</span> <span class="o">^</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK_INV</span><span class="p">;</span>
<span class="n">UCT3</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span> <span class="o">=</span> <span class="n">FB_GROUP</span><span class="p">[</span><span class="n">fb_to_fb_group</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">UCT3</span> <span class="o">^</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK_INV</span><span class="p">;</span>
<span class="n">FCLKx</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">FCLKx</span> <span class="o">^</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK_INV</span><span class="p">;</span>
<span class="n">endcase</span>

<span class="k">case</span><span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST_MUX</span><span class="p">)</span>
<span class="n">LCTx</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LCTx</span><span class="p">;</span>
<span class="n">UCT1</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span> <span class="o">=</span> <span class="n">FB_GROUP</span><span class="p">[</span><span class="n">fb_to_fb_group</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">UCT1</span><span class="p">;</span>
<span class="n">GND</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">endcase</span>

<span class="k">case</span><span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET_MUX</span><span class="p">)</span>
<span class="n">LCTx</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LCTx</span><span class="p">;</span>
<span class="n">UCT2</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span> <span class="o">=</span> <span class="n">FB_GROUP</span><span class="p">[</span><span class="n">fb_to_fb_group</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">UCT2</span><span class="p">;</span>
<span class="n">GND</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">endcase</span>

<span class="k">case</span><span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CE_MUX</span><span class="p">)</span>
<span class="n">PT</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CE</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">PT</span><span class="p">[</span><span class="mi">9</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>
<span class="n">LCT4</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CE</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LCT4</span><span class="p">;</span>
<span class="n">endcase</span>

<span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D_SHIFT</span><span class="p">)</span>
    <span class="k">case</span><span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D_SHIFT_DIR</span><span class="p">)</span>
    <span class="n">UP</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span><span class="p">;</span>
    <span class="n">DOWN</span><span class="p">:</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span><span class="p">;</span>
    <span class="n">endcase</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D_IREG</span><span class="p">)</span>
    <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">IOB</span><span class="o">.</span><span class="n">I</span><span class="p">;</span>
<span class="k">else</span>
    <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LUT_OUT</span><span class="p">;</span>

<span class="n">initial</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">case</span><span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_MODE</span><span class="p">)</span>
<span class="o">//</span> <span class="n">Pretend</span> <span class="n">the</span> <span class="n">usual</span> <span class="n">synth</span><span class="o">/</span><span class="n">sim</span> <span class="n">mismatch</span> <span class="n">doesn</span><span class="s1">&#39;t happen.</span>
<span class="n">DFF</span><span class="p">:</span>
    <span class="n">always</span> <span class="o">@</span><span class="p">(</span><span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span><span class="p">,</span> <span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span><span class="p">,</span> <span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span><span class="p">;</span>
<span class="n">TFF</span><span class="p">:</span>
    <span class="n">always</span> <span class="o">@</span><span class="p">(</span><span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span><span class="p">,</span> <span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span><span class="p">,</span> <span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">^=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span><span class="p">;</span>
<span class="n">LATCH</span><span class="p">:</span>
    <span class="n">always</span> <span class="o">@*</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span><span class="p">;</span>
<span class="n">DFFCE</span><span class="p">:</span>
    <span class="n">always</span> <span class="o">@</span><span class="p">(</span><span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CLK</span><span class="p">,</span> <span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span><span class="p">,</span> <span class="n">posedge</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">RST</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SET</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">CE</span><span class="p">)</span>
            <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG</span> <span class="o">=</span> <span class="n">FB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">MC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">REG_D</span><span class="p">;</span>
<span class="n">endcase</span>
</pre></div>
</div>
</section>
<section id="macrocell-and-iob-outputs">
<h2>Macrocell and IOB outputs<a class="headerlink" href="#macrocell-and-iob-outputs" title="Link to this heading"></a></h2>
<p>Macrocells come in two variants: ones with IOBs and buried macrocells (without IOBs).</p>
<p>A macrocell with IOB has two outputs to ZIA:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_ZIA_OUT</span></code>: routable from the LUT2 or register output</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].IOB_ZIA_OUT</span></code>: routable from the IOB’s input buffer or register output</p></li>
</ul>
<p>A macrocell with IOB also has an output to the IOB:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_IOB_OUT</span></code>: routable from the LUT2 or register output</p></li>
</ul>
<p>The muxes for all three of the above signals are independent, allowing any two of
IBUF, LUT2, and register output to be routed to the ZIA, and also independently connect
either LUT2 or register output to the output buffer.</p>
<p>A buried macrocell has only one output to ZIA, <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_ZIA_OUT</span></code>.  It is thus
not possible to use both its combinatorial and registered output at the same time.</p>
<p>The fuses involved are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_ZIA_MUX</span></code>: controls routing to <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_ZIA_OUT</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">REG</span></code>: routes from <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].REG</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LUT</span></code>: routes from <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].LUT_OUT</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_IOB_MUX</span></code>: controls routing to <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_IOB_OUT</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">REG</span></code>: routes from <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].REG</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LUT</span></code>: routes from <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].LUT_OUT</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].IOB_ZIA_MUX</span></code>: controls routing to <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].IOB_ZIA_OUT</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">REG</span></code>: routes from <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].REG</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IBUF</span></code>: routes from <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].IOB.I</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="input-output-buffer">
<h2>Input/output buffer<a class="headerlink" href="#input-output-buffer" title="Link to this heading"></a></h2>
<p>All I/O buffers (except <code class="docutils literal notranslate"><span class="pre">GCLK*</span></code> pins which are input-only) are associated with a macrocell.
Not all MCs have associated IOBs.</p>
<p>The output buffer is controlled by the <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].MC_IOB_OUT</span></code> and <code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].OE</span></code> signals of the macrocell.</p>
<p>The OE signal is routable from:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GND</span></code>: const-0 (input-only pin)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VCC</span></code>: const-1 (output-only pin)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LCT[0126]</span></code>: local control terms</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT0</span></code>: universal control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PULLUP</span></code>: special option; like <code class="docutils literal notranslate"><span class="pre">GND</span></code>, but also enables a weak pull-up on the pin</p></li>
</ul>
<p>The output slew rate is programmable between two settings, “fast” and “slow”.</p>
<p>Each I/O buffer has the following fuses:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].OE_MUX</span></code>: selects output enable source</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">GND</span></code>: const-0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VCC</span></code>: const-1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LCTx</span></code>: per-FB local control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UCT1</span></code>: universal control term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PULLUP</span></code>: const-0 and enable weak pull-up resistor</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FB[i].MC[j].IOB_SLEW</span></code>: selects slew rate, one of:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">SLOW</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FAST</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="misc-configuration">
<h2>Misc configuration<a class="headerlink" href="#misc-configuration" title="Link to this heading"></a></h2>
<p>The XPLA3 devices also have some global configuration fuses that affect the whole device:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">READ_PROT</span></code>: if programmed, the device is read-protected, and the bitstream cannot be read back (except for UES area)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ISP_DISABLE</span></code>: if programmed, and not overriden by <code class="docutils literal notranslate"><span class="pre">PORT_EN</span></code>, the special function of the JTAG pins is disabled, and the pins are controlled by the macrocells as normal I/O; if not programmed, the JTAG pins retain their special functions and the relevant IOBs are disconnected from macrocell control</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UES</span></code> (user electronic signature): this scratchpad multi-bit field can be used for any user-defined purpose; it is exempt from read protection; the exact size of this field varies with device</p></li>
</ul>
<p>When used by ISE, the UES field stores 8-bit ASCII data, with MSB-first bit numbering (ie. bit 0 of <code class="docutils literal notranslate"><span class="pre">UES</span></code> is the MSB of first character).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bitstream.html" class="btn btn-neutral float-right" title="Bitstream structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Wanda.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>