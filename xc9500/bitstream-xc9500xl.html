<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Bitstream (XC9500XL) - Project Combine</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Project Combine</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="bitstream-structure--xc9500xlxv"><a class="header" href="#bitstream-structure--xc9500xlxv">Bitstream structure — XC9500XL/XV</a></h1>
<p>The main differences from XC9500 are:</p>
<ol>
<li>The UIM wire-AND area is completely gone, only the main areas exist.</li>
<li>The main area has 108 rows per FB instead of 72.</li>
<li>Unprogrammed fuse state is <code>0</code>, programmed fuse state is <code>1</code>.
Thus, the sense of every bitstream bit is inverted from the XC9500 version.</li>
<li>While in XC9500 all areas are loaded sequentially, in XC9500XL/XV the areas
are loaded in parallel.  Thus, the JTAG unit is not a byte, but a word of
size <code>8 * num_fbs</code>.  Likewise, the bytes for each FB are interleaved
in the JED format.</li>
</ol>
<p>On a high level, the whole bitstream is split into "areas".  Each FB
of the device corresponds to one area.</p>
<p>Each area is made of 108 "rows".  Each row is made of 15 "columns".
Each column is made of 6 or 8 bits: columns 0-8 are made of 8 bits, while
columns 9-14 are made of 6 bits.</p>
<p>The low 6 bits of every column are used to store product term masks, and
the high 2 bits of columns 0-8 are used to store everything else.</p>
<p>When programmed or read via JTAG, the bitstream is transmitted as words.
Each word is 8 bits per FB.  Each word of the bitstream has its address.
Not all addresses are valid, and valid addresses are not contiguous.
Address is 16 bits long, and is split to several fields:</p>
<ul>
<li>bits 12-15: FB index (only used for JTAG <code>FERASE</code> operation, doesn't matter for reading and programming)</li>
<li>bits 5-11: row</li>
<li>bits 3-4: column / 5</li>
<li>bits 0-2: column % 5</li>
</ul>
<p>The unprogrammed state of a bit on XC9500XL/XV is <code>0</code>.
The programmed state is <code>1</code>.  Thus, whenever a boolean fuse is mentioned
in the documentation, the "true" value is actually represented as <code>1</code>
in the bitstream.</p>
<h2 id="jed-format-mapping"><a class="header" href="#jed-format-mapping">JED format mapping</a></h2>
<p>In the JED format, all fuses of the device are simply concatenated in order,
skipping over invalid addresses.  The bytes are <em>not</em> padded to 8 bits, but
have their native size.  Thus, converting from JED fuse index to device
address involves some complex calculations::</p>
<pre><code class="language-python">row_bits = (8 * 9 + 6 * 6) * device.num_fbs
total_bits = row_bits * 108

def jed_to_jtag(fuse):
    row = fuse // row_bits
    fuse %= row_bits
    if fuse &lt; 8 * 9 * device.num_fbs:
        column = fuse // (8 * device.num_fbs)
        fuse %= (8 * device.num_fbs)
        fb = fuse // 8
        bit = fuse % 8
    else:
        fuse -= 8 * 9 * device.num_fbs
        column = 9 + fuse // (6 * device.num_fbs)
        fuse %= (6 * device.num_fbs)
        fb = fuse // 6
        bit = fuse % 6
    return (
        row &lt;&lt; 5 | 
        (column // 5) &lt;&lt; 3 |
        (column % 5)
    ), (fb * 8 + bit)

def jtag_to_jed(addr, bit):
    fb = bit // 8
    bit %= 8
    row = addr &gt;&gt; 5 &amp; 0x7f
    assert row &lt; 108
    col_hi = addr &gt;&gt; 3 &amp; 3
    assert col_hi &lt; 3
    col_lo = addr &amp; 7
    assert col_lo &lt; 5
    column = col_hi * 5 + col_lo
    if column &lt; 9:
        cfuse = column * 8 * device.num_fbs + fb * 8 + bit
    else:
        cfuse = 8 * 8 + (column - 9) * 6 * device.num_fbs + fb * 6 + bit
    return row * row_bits + cfuse
</code></pre>
<h2 id="fuses--product-terms"><a class="header" href="#fuses--product-terms">Fuses — product terms</a></h2>
<p>The product term masks are stored in bits 0-5 of every column and every row of the main area.
The formulas are as follows (unchanged from XC9500, but now with more rows):</p>
<ol>
<li><code>FB[i].MC[j].PT[k].IM[l].P</code> is stored at:
<ul>
<li>row: <code>l * 2 + 1</code></li>
<li>column: <code>k + (j % 3) * 5</code></li>
<li>bit: <code>j // 3</code></li>
</ul>
</li>
<li><code>FB[i].MC[j].PT[k].IM[l].N</code> is stored at:
<ul>
<li>row: <code>l * 2</code></li>
<li>column: <code>k + (j % 3) * 5</code></li>
<li>bit: <code>j // 3</code></li>
</ul>
</li>
</ol>
<h2 id="fuses--macrocells"><a class="header" href="#fuses--macrocells">Fuses — macrocells</a></h2>
<p>Per-MC config fuses (that are not product term masks) are stored in bits 6-7 of
columns 0-8 of rows 12-49 of the main area.  The formulas are as follows:</p>
<ul>
<li>row: corresponds to fuse function</li>
<li>column: <code>mc_idx % 9</code></li>
<li>bit: <code>6 + mc_idx // 9</code></li>
</ul>
<p>{{tile xc9500xl mc}}
{{tile xc9500xv mc}}</p>
<h2 id="fuses--fb-inputs"><a class="header" href="#fuses--fb-inputs">Fuses — FB inputs</a></h2>
<p>The FB input mux configuraton is stored in rows 50-76, columns 0-8, bits 6-7.
<code>FB[i].IM[j].MUX</code> has 9 bits and is stored at the following coordinates:</p>
<ul>
<li>row: <code>50 + j % 27</code></li>
<li>column: mux fuse index (0-8)</li>
<li>bit: 6 if <code>j &lt; 27</code>, 7 otherwise</li>
</ul>
<p>The exact bit assignments are irregular and should be obtained from the database.</p>
<h2 id="fuses--per-fb-bits-and-globals"><a class="header" href="#fuses--per-fb-bits-and-globals">Fuses — per-FB bits and globals</a></h2>
<p>Per-FB bits are stored in row 78, columns 0-8, bits 6-7.  The bits are (row, bit, column):</p>
<p>{{tile xc9500xl fb}}
{{tile xc9500xv fb}}</p>
<p>Global bits are stored in rows (2, 6, 7), columns 0-8, bits 6-7 of FB 0.  The bits are (fb, row, bit, column):</p>
<p>{{tile xc9500xl global}}
{{tile xc9500xv global}}</p>
<p>The <code>DONE</code> bit is only applicable to XC9500XV.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../xc9500/bitstream-xc9500.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../xc9500/database.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../xc9500/bitstream-xc9500.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../xc9500/database.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
