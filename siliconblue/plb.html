<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Logic block - Project Combine</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Project Combine</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="logic-block"><a class="header" href="#logic-block">Logic block</a></h1>
<p>The PLB, or programmable logic block, consists of:</p>
<ul>
<li>3 shared control inputs
<ul>
<li><code>CLK</code>, the clock</li>
<li><code>CE</code>, the clock enable</li>
<li><code>RST</code>, the reset signal</li>
</ul>
</li>
<li>8 LCs (logic cells), each consisting of:
<ul>
<li>a four-input LUT</li>
<li>carry logic</li>
<li>a flip-flop</li>
</ul>
</li>
<li>a carry chain</li>
<li>a LUT cascade chain (iCE40 only) or hard logic input (<code>iCE40T0*</code> only)</li>
</ul>
<h2 id="luts-and-lut-inputs"><a class="header" href="#luts-and-lut-inputs">LUTs and LUT inputs</a></h2>
<p>Each LC contains a 4-input LUT.  The 4 inputs to the LUT are called <code>LC[0-7].I[0-3]</code>.  The output of the LUT is called <code>LC[0-7].LTOUT</code>.</p>
<p>The LUT inputs usually come directly from general interconnect.  However, two of the inputs are special:</p>
<ul>
<li><code>I3</code> can be driven by the LC's carry input, <code>LC[0-7].CIN</code>.  This is encoded in the bitstream as a special <code>CI</code> value for the relevant general interconnect <code>MUX</code> field.</li>
<li>on iCE40 only, <code>I2</code> can be driven from the special <code>LC[0-7].LTIN</code> input.  This is encoded in the bitstream as a separate <code>LC{i}:MUX.I2</code> field, selecting between general interconnect and <code>LTIN</code>.</li>
</ul>
<p>For most PLBs, the <code>LTIN</code> input is used to implement LUT cascading: <code>LTIN</code> is connected directly to <code>LTOUT</code> of the previous LC in the PLB, or to <code>LC7.LTOUT</code> of the PLB to the south for <code>LC0.LTIN</code>.</p>
<p>However, on <code>iCE40T0*</code>, some <code>PLB</code> tiles are designated as "IP connect" tiles, and their <code>LTIN</code> is instead connected to the output of some hard logic block.  To route the hard logic output to the fabric, the LC should be configured as combinational, with <code>0xf0f0</code> as the LUT table, and with <code>LTIN</code> input selected.  The LUT cascading cannot be used in those tiles.</p>
<p>The <code>PLB</code> tiles designed as "IP connect" are:</p>
<ul>
<li><code>iCE40T04</code> and <code>iCE40T05</code>: all <code>PLB</code>s within the westernmost and easternmost columns</li>
<li><code>iCE40T01</code>: the southernmost three and northernmost three <code>PLB</code>s within the westernmost and easternmost columns</li>
</ul>
<h2 id="carry-chain-and-carry-logic"><a class="header" href="#carry-chain-and-carry-logic">Carry chain and carry logic</a></h2>
<p>In addition to the LUT, each LC also has:</p>
<ul>
<li>
<p>a carry input, <code>LC[0-7].CIN</code></p>
</li>
<li>
<p>a carry output, <code>LC[0-7].COUT</code></p>
</li>
<li>
<p>a carry logic primitive, implementing a fixed majority function over the LC's <code>CIN</code>, <code>I1</code>, <code>I2</code> inputs:</p>
<pre><code>LC[i].COUT = MAJ(LC[i].I1, LC[i].I2, LC[i].CIN) = (
  (LC[i].CIN &amp; LC[i].I1) |
  (LC[i].CIN &amp; LC[i].I2) |
  (LC[i].I1 &amp; LC[i].I2)
)
</code></pre>
</li>
</ul>
<p>The carry logic primitive is only functional when the <code>LC{i}:CARRY_ENABLE</code> bit is set in the bitstream.  Without that, the carry output is indeterminate.</p>
<p>The <code>CIN</code> inputs of LCs 1-7 are connected directly to <code>COUT</code> outputs of LCs 0-6 of the same PLB.</p>
<p>The <code>CIN</code> input of LC 0 can be selected (via <code>LC0:MUX.CI</code>) from one of:</p>
<ul>
<li>const <code>0</code></li>
<li>const <code>1</code></li>
<li><code>CHAIN</code>: <code>LC7.COUT</code> of the <code>PLB</code> to the south</li>
</ul>
<h2 id="flip-flops"><a class="header" href="#flip-flops">Flip-flops</a></h2>
<p>Every LC includes a flip-flop that may be optionally enabled.  If the flip-flop is enabled, the combinational output of the LUT is not available outside the LC, except for the LUT cascade function.</p>
<p>The flip-flop always has an initial value of 0.  The reset signal can be synchronous or asynchronous, and the reset value can be configured via the bitstream.  The clock enable has priority over the synchronous reset.</p>
<p>The flip-flop implements the following logic:</p>
<pre><code>if (!LC[i].FF_ENABLE) begin

    assign LC[i].OUT = LC[i].LTOUT;

end else if (LC[i].FF_SR_ASYNC) begin

    initial LC[i].OUT = 0;

    always @(posedge CLK, posedge RST)
        if (RST)
            LC[i].OUT &lt;= LC[i].FF_SR_VALUE;
        else if (CE)
            LC[i].OUT &lt;= LC[i].LTOUT;

end else begin

    initial LC[i].OUT = 0;

    always @(posedge CLK)
        if (CE) begin
            if (RST)
                LC[i].OUT &lt;= LC[i].FF_SR_VALUE;
            else
                LC[i].OUT &lt;= LC[i].LTOUT;
        end

end
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../siliconblue/global.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../siliconblue/ice65l04.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../siliconblue/global.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../siliconblue/ice65l04.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
