<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Block RAM - Project Combine</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Project Combine</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="block-ram"><a class="header" href="#block-ram">Block RAM</a></h1>
<p>The <code>BRAM</code> tile contains one bel, the block RAM. It corresponds to four vertically stacked interconnect tiles. The <code>BRAM</code> bel is a significantly improved version of the Virtex 2 block RAM, introducing:</p>
<ul>
<li>optional data output pipeline registers</li>
<li>hardware ECC encoder and decoder (with error correction)</li>
<li>per-byte write enable</li>
<li>cascade capability, for chaining two vertically adjacent BRAMs into one 32768×1 RAM</li>
<li>independent read and write width for a port</li>
<li>hardware FIFO controller</li>
</ul>
<p>The <code>BRAM</code> bel can be used in three ways:</p>
<ul>
<li>plain RAM mode, corresponding to <code>RAMB16</code> library primitive</li>
<li>ECC RAM mode, corresponding to <code>RAMB32_S64_ECC</code> library primitive; this requires a pair of <code>BRAM</code> tiles, aligned to a multiple of 8 rows</li>
<li>FIFO mode, corresponding to <code>FIFO16</code> library primitive</li>
</ul>
<p>The bel has the following inputs connected via general interconnect:</p>
<ul>
<li><code>CLK[AB]</code> (freely invertible through the interconnect): clocks for port A and port B</li>
<li><code>EN[AB]</code> (freely invertible through the interconnect): enable for port A and port B</li>
<li><code>SSR[AB]</code> (freely invertible through the interconnect): synchronous set/reset for the read ports</li>
<li><code>REGCE[AB]</code> (freely invertible through the interconnect): pipeline register clock enable for read ports</li>
<li><code>WE[AB][0-3]</code> (freely invertible through the bel): per-byte write enable for port A and port B</li>
<li><code>ADDR[AB]0</code> through <code>ADDR[AB]14</code>, the address buses for port A and port B; <code>ADDR[AB]14</code> is used only for cascade mode, and must be tied high otherwise</li>
<li><code>DI[AB]0</code> through <code>DI[AB]31</code>: the main data input for port A and port B</li>
<li><code>DIP[AB]0</code> through <code>DIP[AB]3</code>: the parity data input for port A and port B</li>
</ul>
<p>The bel has the following output pins connected via general interconnect:</p>
<ul>
<li><code>DO[AB]0</code> through <code>DO[AB]31</code>: the main data output for port A and port B</li>
<li><code>DOP[AB]0</code> through <code>DOP[AB]3</code>: the parity data output for port A and port B</li>
</ul>
<p>The bel also has special pins routed through dedicated interconnect:</p>
<ul>
<li><code>CASCADEOUT[AB]</code>: cascade outputs, used to implement the cascade function</li>
<li><code>CASCADEIN[AB]</code>: cascade inputs, connected to the <code>CASCADEOUT[AB]</code> pins of the BRAM in the tile immediately below</li>
</ul>
<p>The cascade is not routed across PowerPC holes — cascade functionality cannot be used between BRAMs on two sides of the PowerPC hole.</p>
<p>The attributes of the <code>BRAM</code> bel are:</p>
<ul>
<li>
<p><code>MODE</code>: selects the operating mode of the bel</p>
<ul>
<li><code>RAM</code>: implements a RAM</li>
<li><code>FIFO</code>: implements a FIFO</li>
</ul>
</li>
<li>
<p><code>WE[AB][0-3]INV</code>: when set, the corresponding pin is inverted</p>
</li>
<li>
<p><code>EN_ECC_READ</code> (4-bit value) and <code>EN_ECC_WRITE</code> (4-bit value): must all be set when in ECC mode, exact workings unknown</p>
</li>
<li>
<p><code>READ_WIDTH_[AB]</code> selects the read width of the given port; the values are:</p>
<ul>
<li><code>1</code>: <code>DO[AB]0</code> is used for data, <code>ADDR[AB][0-14]</code> is used for address</li>
<li><code>2</code>: <code>DO[AB][01]</code> is used for data, <code>ADDR[AB][1-14]</code> is used for address</li>
<li><code>4</code>: <code>DO[AB][0-3]</code> is used for data, <code>ADDR[AB][2-14]</code> is used for address</li>
<li><code>9</code>: <code>DO[AB][0-7]</code> and <code>DOP[AB]0</code> are used for data, <code>ADDR[AB][3-14]</code> is used for address</li>
<li><code>18</code>: <code>DO[AB][0-15]</code> and <code>DOP[AB][01]</code> are used for data, <code>ADDR[AB][4-14]</code> is used for address</li>
<li><code>36</code>: <code>DO[AB][0-31]</code> and <code>DOP[AB][0-3]</code> are used for data, <code>ADDR[AB][5-14]</code> is used for address</li>
</ul>
</li>
<li>
<p><code>WRITE_WIDTH_[AB]</code> selects the write width of the given port; the values are:</p>
<ul>
<li><code>1</code>: <code>DI[AB]0</code> is used for data, <code>ADDR[AB][0-14]</code> is used for address</li>
<li><code>2</code>: <code>DI[AB][01]</code> is used for data, <code>ADDR[AB][1-14]</code> is used for address</li>
<li><code>4</code>: <code>DI[AB][0-3]</code> is used for data, <code>ADDR[AB][2-14]</code> is used for address</li>
<li><code>9</code>: <code>DI[AB][0-7]</code> and <code>DIP[AB]0</code> are used for data, <code>ADDR[AB][3-14]</code> is used for address</li>
<li><code>18</code>: <code>DI[AB][0-15]</code> and <code>DIP[AB][01]</code> are used for data, <code>ADDR[AB][4-14]</code> is used for address</li>
<li><code>36</code>: <code>DI[AB][0-31]</code> and <code>DIP[AB][0-3]</code> are used for data, <code>ADDR[AB][5-14]</code> is used for address</li>
</ul>
</li>
<li>
<p><code>FIFO_WIDTH</code>: selects the data width when in FIFO mode; must be equal to <code>READ_WIDTH_A</code> and <code>WRITE_WIDTH_B</code></p>
</li>
<li>
<p><code>WRITE_MODE_[AB]</code>: selects behavior of the read port when writing, the values are:</p>
<ul>
<li><code>WRITE_FIRST</code>: data output shows just-written data</li>
<li><code>READ_FIRST</code>: data output shows data previously in memory at the given address</li>
<li><code>NO_CHANGE</code>: the data output is unchanged from previous cycle</li>
</ul>
<p>Both of these attributes must be set to <code>WRITE_FIRST</code> in FIFO mode.</p>
</li>
<li>
<p><code>SRVAL_[AB]</code> (36-bit value): selects the set/reset value of the read port; the low 32 bits correspond to <code>DO[AB][0-31]</code> while the high 4 bits correspond to <code>DOP[AB][0-3]</code></p>
</li>
<li>
<p><code>INIT_[AB]</code> (36-bit value): selects the initial value of the read port; the low 32 bits correspond to <code>DO[AB][0-31]</code> while the high 4 bits correspond to <code>DOP[AB][0-3]</code></p>
</li>
<li>
<p><code>DO[AB]_REG</code> : selects number of pipeline registers for read port</p>
<ul>
<li><code>0</code>: no pipeline registers, just output latches; same behavior as older FPGAs</li>
<li><code>1</code>: one additional pipeline register on the read port</li>
</ul>
<p>Both of these attributes must be set to <code>WRITE_FIRST</code> in FIFO mode.</p>
</li>
<li>
<p><code>RAM_EXTENSION_[AB]</code>: controls the cascade mode for the given port</p>
<ul>
<li>
<p><code>NONE_UPPER</code>: the port is not in cascade mode, or it is the upper BRAM in cascade mode</p>
<ul>
<li>when <code>ADDR[AB]14</code> is high, data is written to BRAM and/or read from BRAM</li>
<li>when <code>ADDR[AB]14</code> is low, data is not written to BRAM; read data is forwarded from <code>CASCADEIN[AB]</code></li>
</ul>
<p>If the BRAM is not part of cascade, <code>ADDR[AB]14</code> should be tied high.</p>
</li>
<li>
<p><code>LOWER</code>: the port is the lower BRAM in cascade mode</p>
<ul>
<li>when <code>ADDR[AB]14</code> is high, data is not written to BRAM</li>
<li>when <code>ADDR[AB]14</code> is low, data is written to BRAM</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>INVERT_CLK_DO[AB]_REG</code>: if set, the clock controlling the pipeline register is inverted from <code>CLK[AB]</code></p>
</li>
<li>
<p><code>DATA</code> (16384-bit value): the initial data for the BRAM main plane; corresponds to concatenation of <code>INIT_xx</code> primitive attributes</p>
</li>
<li>
<p><code>DATAP</code> (2048-bit value): the initial data for the BRAM parity plane; corresponds to concatenation of <code>INITP_xx</code> primitive attributes</p>
</li>
<li>
<p><code>SAVEDATA</code> (64-bit value): if set, the BRAM data will not be written during partial reconfiguration; the attribute has one bit per frame of the bitstream BRAM data tile</p>
</li>
<li>
<p><code>FIRST_WORD_FALL_THROUGH</code>: like the corresponding <code>FIFO16</code> attribute</p>
</li>
<li>
<p><code>ALMOST_FULL_OFFSET</code> (12-bit value): like the corresponding <code>FIFO16</code> attribute</p>
</li>
<li>
<p><code>ALMOST_EMPTY_OFFSET</code> (12-bit value): like the corresponding <code>FIFO16</code> attribute, except the bitstream value is:</p>
<ul>
<li>1 smaller then primitive attribute when not in FWFT mode</li>
<li>2 smaller then primitive attribute when in FWFT mode</li>
</ul>
</li>
<li>
<p><code>WW_VALUE</code>: unknown purpose, must be set to <code>NONE</code></p>
</li>
</ul>
<p>TODO: details of <code>SAVEDATA</code></p>
<h2 id="fifo-mode"><a class="header" href="#fifo-mode">FIFO mode</a></h2>
<p>When used in FIFO mode, the pins are repurposed as follows:</p>
<ul>
<li><code>CLKA</code>: becomes <code>RDCLK</code></li>
<li><code>CLKB</code>: becomes <code>WRCLK</code></li>
<li><code>ENA</code>: becomes <code>RDEN</code></li>
<li><code>ENB</code>: becomes <code>WREN</code></li>
<li><code>SSRA</code>: becomes <code>RST</code></li>
<li><code>SSRB</code>: unused</li>
<li><code>REGCE[AB]</code>: unused</li>
<li><code>WE[AB]*</code>: unused</li>
<li><code>ADDR[AB]*</code>: unused; address generation is done internally by FIFO logic</li>
<li><code>DIB*</code> and <code>DIPB*</code>: used as <code>DI*</code> and <code>DIP*</code>, the data input</li>
<li><code>DIA*</code> and <code>DIPA*</code>: unused</li>
<li><code>DOA*</code> and <code>DOPA*</code>: used as <code>DO*</code> and <code>DOP*</code>, the data output</li>
<li><code>DOB[0-3]</code>: becomes <code>RDCOUNT[0-3]</code></li>
<li><code>DOB4</code>: unused</li>
<li><code>DOB5</code>: becomes <code>RDERR</code></li>
<li><code>DOB6</code>: becomes <code>ALMOSTEMPTY</code></li>
<li><code>DOB7</code>: becomes <code>EMPTY</code></li>
<li><code>DOB8</code>: becomes <code>FULL</code></li>
<li><code>DOB9</code>: becomes <code>ALMOSTFULL</code></li>
<li><code>DOB10</code>: becomes <code>WRERR</code></li>
<li><code>DOB11</code>: unused</li>
<li><code>DOB[12-15]</code>: becomes <code>RDCOUNT[8-11]</code></li>
<li><code>DOB[16-23]</code>: becomes <code>WRCOUNT[0-7]</code></li>
<li><code>DOB[24-27]</code>: becomes <code>RDCOUNT[4-7]</code></li>
<li><code>DOB[28-31]</code>: becomes <code>WRCOUNT[8-11]</code></li>
</ul>
<p>TODO: details of FIFO mode</p>
<h2 id="ecc-mode"><a class="header" href="#ecc-mode">ECC mode</a></h2>
<p>To use the ECC mode an implement a <code>RAMB32_S64_ECC</code> primitive, do the following:</p>
<ul>
<li>
<p>pick a pair of aligned adjacent BRAM tiles (the lower one having bottom row index divisible by 8)</p>
</li>
<li>
<p>use the <code>A</code> port for reading, <code>B</code> port for writing</p>
</li>
<li>
<p>connect <code>CLK[AB]</code>, <code>EN[AB]</code>, <code>ADDR[AB]</code> appropriately, mirroring them across both BRAMs</p>
</li>
<li>
<p>tie <code>WEA*</code> low, <code>WEB*</code> high</p>
</li>
<li>
<p>tie <code>REGCEA</code> high</p>
</li>
<li>
<p>tie <code>SSR[AB]</code> low</p>
</li>
<li>
<p>set <code>DOA_REG</code> appropriately</p>
</li>
<li>
<p>set <code>EN_ECC_READ</code> and <code>EN_ECC_WRITE</code> to all-1</p>
</li>
<li>
<p>set <code>READ_WIDTH_[AB]</code> and <code>WRITE_WIDTH_[AB]</code> to <code>36</code></p>
</li>
<li>
<p>connect <code>DI</code> and <code>DO</code> of the primitive as follows:</p>
<ul>
<li>bits 0-13 to lower <code>D{IB|OA}[0-13]</code></li>
<li>bit 14 to lower <code>D{IB|OA}P1</code></li>
<li>bit 15 to lower <code>D{IB|OA}P3</code></li>
<li>bits 16-29 to lower <code>D{IB|OA}[16-19]</code></li>
<li>bit 30 to lower <code>D{IB|OA}P0</code></li>
<li>bit 31 to lower <code>D{IB|OA}P2</code></li>
<li>bits 32-45 to upper <code>D{IB|OA}[0-13]</code></li>
<li>bit 46 to upper <code>D{IB|OA}P1</code></li>
<li>bit 47 to upper <code>D{IB|OA}P3</code></li>
<li>bits 48-61 to upper <code>D{IB|OA}[16-19]</code></li>
<li>bit 62 to upper <code>D{IB|OA}P0</code></li>
<li>bit 63 to upper <code>D{IB|OA}P2</code></li>
</ul>
</li>
<li>
<p>connect <code>STATUS[0]</code> of the primitive to lower <code>DOA31</code></p>
</li>
<li>
<p>connect <code>STATUS[0]</code> of the primitive to upper <code>DOA0</code></p>
</li>
</ul>
<p>TODO: details of ECC mode</p>
<h2 id="bitstream"><a class="header" href="#bitstream">Bitstream</a></h2>
<p>The data for a BRAM is spread across 5 bitstream tiles:</p>
<ul>
<li>tiles 0-3: the 4 bitstream tiles that are shared with the <code>INT</code> interconnect tiles (starting from the bottom)</li>
<li>tile 4: the dedicated BRAM data tile located in the BRAM data area; this tile is 64×320 bits; it contains solely the <code>DATA</code> and <code>DATAP</code> attributes and the <code>SAVEDATA</code> attribute</li>
</ul>
<p>{{tile virtex4 BRAM}}</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../virtex4/clb.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../virtex4/dsp.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../virtex4/clb.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../virtex4/dsp.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
